{% extends "base.html" %}
{% block content %}

<div class="booking-container">

<h2>Book a Home Service</h2>

<form id="bookingForm" method="POST">

    <div class="form-group">
        <label>Full Name *</label>
        <input type="text" name="name" id="name" required>
    </div>

    <div class="form-group">
        <label>Phone Number (WhatsApp) *</label>
        <input type="text" name="phone" id="phone" required>
    </div>

    <!-- MULTI SERVICE SELECTION -->
    <div class="form-group">
        <label>Select Services *</label>

        <div class="services-checkbox">

            <label class="service-option">
                <input type="checkbox" name="services[]" value="AC Repair" onchange="updatePrice()">
                <span>AC Repair</span>
            </label>

            <label class="service-option">
                <input type="checkbox" name="services[]" value="Electrician" onchange="updatePrice()">
                <span>Electrician</span>
            </label>

            <label class="service-option">
                <input type="checkbox" name="services[]" value="Plumbing" onchange="updatePrice()">
                <span>Plumbing</span>
            </label>

            <label class="service-option">
                <input type="checkbox" name="services[]" value="Painting" onchange="updatePrice()">
                <span>Painting</span>
            </label>

            <label class="service-option">
                <input type="checkbox" name="services[]" value="Garden" onchange="updatePrice()">
                <span>Garden Maintenance</span>
            </label>

            <label class="service-option">
                <input type="checkbox" name="services[]" value="Pest Control" onchange="updatePrice()">
                <span>Pest Control</span>
            </label>

        </div>
    </div>

    <div class="form-group">
        <label>Complete Address *</label>
        <textarea name="address" id="address" required></textarea>
    </div>

    <!-- PRICE -->
    <div class="price-box">
        Total Price: ₹<span id="price">0</span>
    </div>

    <button type="submit">Confirm Booking</button>

</form>

<button class="whatsapp-btn" onclick="sendWhatsApp()">Book via WhatsApp</button>

</div>

<script>
let prices = {
    "AC Repair": 499,
    "Electrician": 199,
    "Plumbing": 299,
    "Painting": 2000,
    "Garden": 499,
    "Pest Control": 999
};

function updatePrice() {
    let total = 0;
    let selectedServices = document.querySelectorAll('input[name="services[]"]:checked');

    selectedServices.forEach(service => {
        total += prices[service.value];
    });

    document.getElementById("price").innerText = total;
}

// WhatsApp Auto Booking
function sendWhatsApp() {
    let name = document.getElementById("name").value;
    let phone = document.getElementById("phone").value;
    let address = document.getElementById("address").value;

    let selectedServices = document.querySelectorAll('input[name="services[]"]:checked');
    if (selectedServices.length === 0) {
        alert("Please select at least one service");
        return;
    }

    let serviceList = [];
    let total = 0;

    selectedServices.forEach(service => {
        serviceList.push(service.value);
        total += prices[service.value];
    });

    let msg = `Hi, I want to book a service:%0A
Name: ${name}%0A
Phone: ${phone}%0A
Services: ${serviceList.join(", ")}%0A
Address: ${address}%0A
Total Price: ₹${total}`;

    window.open("https://wa.me/919220194306?text=" + msg);
}
</script>

{% endblock %}
